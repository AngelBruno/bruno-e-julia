import{c as v,d as m,g,q as E,o as w,a as b,s as u,b as h,e as y,f as M}from"./firebase-config-CfDjXtCw.js";let d=[];async function x(){try{const e=v(m,"mesas"),s=await g(e);return!0}catch(e){return console.error("Firebase connection failed:",e),!1}}async function I(){try{const e=v(m,"mesas"),s=E(e,w("chaves","desc")),t=b(s,a=>{d=[],a.forEach(o=>{var c;const n={id:parseInt(o.id),...o.data(),ultimaAtualizacao:((c=o.data().ultimaAtualizacao)==null?void 0:c.toDate())||new Date};d.push(n)}),k(),D(),L()});window.mesasUnsubscribe=t}catch(e){console.error("❌ Error setting up mesas listener:",e)}}async function B(e,s){try{const t={nome:s,chaves:0,ultimaAtualizacao:u()};return await h(y(m,"mesas",e.toString()),t),r(`Mesa "${s}" criada com sucesso!`,"success"),!0}catch(t){return console.error("Error creating mesa:",t),r("Erro ao criar mesa: "+t.message,"error"),!1}}async function C(e,s,t){try{const a=d.find(n=>n.id===e);if(!a)throw new Error("Mesa não encontrada");const o=(a.chaves||0)+s;await h(y(m,"mesas",e.toString()),{chaves:o,ultimaAtualizacao:u()},{merge:!0});try{await M(v(m,"historico"),{mesaId:e,mesaNome:a.nome||"Unknown",quantidade:s,motivo:t||"Adição de chaves",dataHora:u()})}catch(n){console.warn("Could not add to history:",n.message)}return r(`${s} chaves adicionadas!`,"success"),!0}catch(a){return console.error("Error adding keys:",a),r("Erro ao adicionar chaves: "+a.message,"error"),!1}}function k(){const e=document.getElementById("mesas-container");if(!e)return;e.innerHTML="",[...d].sort((t,a)=>a.chaves-t.chaves).forEach((t,a)=>{const o=a+1,n=o===1?"🥇":o===2?"🥈":o===3?"🥉":`${o}º`,c=document.createElement("div");c.className="mesa-item",c.innerHTML=`
            <div class="mesa-info">
                <div class="mesa-nome">${n} ${t.nome}</div>
                <div class="mesa-chaves">${t.chaves} chaves</div>
            </div>
            <div class="mesa-actions">
                <button class="btn btn-sm btn-primary" onclick="quickAddKeys(${t.id})">
                    ➕ Chaves
                </button>
            </div>
        `,e.appendChild(c)})}function D(){["add-mesa-select","remove-mesa-select"].forEach(s=>{const t=document.getElementById(s);t&&(t.innerHTML='<option value="">Selecione uma mesa</option>',d.forEach(a=>{const o=document.createElement("option");o.value=a.id,o.textContent=`${a.nome} (${a.chaves} chaves)`,t.appendChild(o)}))})}function L(){const e=d.reduce((c,i)=>c+i.chaves,0),s=d.length,t=Math.max(0,1e3-e),a=document.getElementById("total-chaves"),o=document.getElementById("total-mesas"),n=document.getElementById("chaves-restantes");a&&(a.textContent=e),o&&(o.textContent=s),n&&(n.textContent=t)}function r(e,s="info"){const t=document.createElement("div");t.style.cssText=`
        position: fixed; top: 20px; right: 20px; z-index: 1001;
        background: ${s==="error"?"#dc3545":"#28a745"}; 
        color: white; padding: 15px 20px;
        border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        max-width: 300px; word-wrap: break-word;
    `,t.textContent=e,document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},s==="error"?5e3:3e3)}window.quickAddKeys=e=>{document.getElementById("add-mesa-select").value=e,document.getElementById("add-quantidade").value="",openModal("add-keys-modal")};window.openModal=e=>{const s=document.getElementById(e);s&&(s.style.display="block")};window.closeModal=e=>{const s=document.getElementById(e);s&&(s.style.display="none")};document.addEventListener("DOMContentLoaded",async()=>{await x()?await I():r("Firebase não configurado. Configure o Firestore para usar o sistema.","error");const s=document.getElementById("nova-mesa-form");s?s.addEventListener("submit",async a=>{a.preventDefault();const o=document.getElementById("mesa-id"),n=document.getElementById("mesa-nome"),c=o==null?void 0:o.value,i=n==null?void 0:n.value,l=parseInt(c),f=i==null?void 0:i.trim();if(!l||!f){r("Preencha todos os campos","error");return}if(d.find(p=>p.id===l)){r("Mesa com este ID já existe","error");return}await B(l,f)&&s.reset()}):console.error('❌ Form "nova-mesa-form" not found!');const t=document.getElementById("add-keys-form");t&&t.addEventListener("submit",async a=>{a.preventDefault();const o=parseInt(document.getElementById("add-mesa-select").value),n=parseInt(document.getElementById("add-quantidade").value),c=document.getElementById("add-motivo").value.trim();if(!o||!n){r("Selecione mesa e quantidade","error");return}await C(o,n,c)&&(closeModal("add-keys-modal"),t.reset())}),window.addEventListener("click",a=>{a.target.classList.contains("modal")&&(a.target.style.display="none")})});
